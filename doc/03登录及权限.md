# 登录及权限

## 总体原则

- 系统使用统一的 API 接口来进行登录
- 系统通过 cookie-session 机制进行登录识别
- 除登录接口, 后端所有接口均需登录后访问, 否则 401
- 除系统管理员, 用户仅可以操作本组织内资源, 否则 403
- 接收到 401 时, 前端需跳转到登陆页, 并设置登录后回跳
- 在 API 传输和数据库存储过程中, 不允许使用密钥到明文

## 登录设计

- 用户通过登录 API, 通过用户名和密钥进行登录, 使用 HTTP POST 方法发送 JSON 请求体至后端(具体格式见下文描述).
- 登录请求体包括用户名和密钥, 均为字符串格式. 其中用户名为明文, 密钥使用 SHA-256 计算加盐的哈希, 其中盐为固定字符串.
- 数据库中存储用户密钥的加盐哈希和盐, 此处的盐为用户注册时动态生成, 使用 SHA-256 进行两次加盐哈希(第一次为上述前端生成)计算后的值存入 password 字段.
- 后端对前端发送的用户名和密钥进行认证, 如果格式不正确则 400, 否则 200, 并在具体的响应体中进行是否成功的说明.

## API 设计

### 登录接口

- 请求: POST /login

```json
{
  "loginName": "Fuck",
  "password": `{SHA256("easy-kanban" + "You")}`
}
```

- 响应 400 (用户名或密钥为空)
- 响应 200 (登录成功)

```json
{
  "success": true,
  "message": "登录成功"
}
```

- 响应 200 (登录失败)

```json
{
  "success": false,
  "message": "用户名或密码错误"
}
```

### 获取当前用户

- 请求: GET /users/current

- 响应 200 (获取成功)

```json
{
  "id": 114514,
  "loginName": "傻逼",
  "nickName": "大傻逼",
  "orgId": 233666,
  "orgName": "傻逼公司",
  "sysAdmin": false
}
```
